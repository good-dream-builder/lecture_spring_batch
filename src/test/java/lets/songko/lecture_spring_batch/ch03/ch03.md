04장 80, p170 '플로우 외부화하기' 건너 뜀.

# 청크 기반 스텝
- 청크는 커밋 간격(commit interval)에 의해 정의된다.

```
커밋 간격을 50개 아이템으로 설정했다면 
잡은 50개 아이템을 읽고(read) 50개 아이템을 처리(process)한 다음에, 
한 번에 50개 아이템을 기록(write) 한다.
```

# CompletionPolicy 인터페이스

- 청크의 완료 여부를 결정할 수 있는 결정 로직을 구현할 수 있게 해준다.
- 청크가 완료되는 시점을 프로그래밍 방식으로 정의할 수 있는 기능
- 두 개의 isComplete 메서드, start 메서드, update 메서드
    - start 메서드는 청크의 시작을 알 수 있도록 정책을 초기화
    - 첫 번째 iscomplete 메서드는 RepeatContext를 파라미터로 전달받게 정의돼 있으며, 내부 상태를 이용해 청크 완료 여부를 판단
    - 두 번째 메서드는 RepeatContext 및 RepeatStatus를 파라미터로 전달받게 정의돼 있으며, 청크 완료 여부의 상태를 기반으로 결정 로직을 수행
- 구현체는 내부에 상태를 저장할 수 있으며 저장된 상태를 사용해 청크가 완료됐는지 결정할 수 있어야 한다.

구현체
SimpleCompletionPolicy

- 처리된 아이템 개수를 세는데, 이 개수가 미리 구성해둔 임겠값에 도달하면 청크 완료로 표시한다.

TimeoutTerminationPolicy

- 타임아웃 값을 구성하면, 청크 내에서 처리 시간이 해당 시간이 넘을 때 안전하게 빠져나갈 수 있다.

CompositeCompletionPolicy

- 청크 완료 여부를 결정하는 여러 정책을 함께 구성할 수 있다.
- 자신이 포함하고 있는 여러 정책 중 하나라도 청크 완료라고 판단된다면 해당 청크가 완료된 것으로 표시한다.

# 스텝 플로우

- 특정 스텝을 처리한 다음에 어떤 스텝을 수행해야 하는지 결정하는 간단한 로직 실행 방법 및 재사용을 위한 외부화 방법

BatchStatus

- 잡이나 스텝의 현재 상태를 식별하는 JobExecution이나 StepExecution의 애트리뷰트

ExitStatus

- 잡이나 스텝 종료 시 스프링 배치로 반환되는 값
- 스텝, 청크, 잡에서 반환될 수 있다
- 스프링 배치는 다음에 어떤 스텝을 수행할지 결정하려고 ExitStatus를 확인한다
- 값의 실체는 문자열이기 때문에, 와일드 카드를 사용하면 흥미로운 일을 할 수 있다
    - `*` : 0개 이상의 문자를 일치
      ```C* 로 검색 : C, COMPLETE, CORRECT와 일치```
    - `?` : 1개 문자를 일치
      ```?AT 로 검색 : CAT, KAT와 일치/ THAT 불일치```

# 잡 종료하기

Completed
- 스프링 배치 처리가 성공적으로 종료
- JobInstance가 Completed 상태로 종료되면 동일한 파라미터를 사용해 다시 실행할 수 없다
- end 메서드를 사용 : 스텝이 반환한 상태가 무엇이든 상관없이 Batch_JOB_EXECUTION에 COMPLETED가 저장

Failed
- 잡이 성공적으로 완료되지 않았음
- Failed 상태로 종료된 잡은 스프링 배치를 사용해 동일한 파라미터로 다시 실행할 수 있다
- fail 메서드를 사용

Stopped
- 잡에 오류가 발생하지 않았지만 중단된 위치에서 잡을 다시 시작할 수 있다.
- 스텝 사이에 사람의 개입이 필요하거나 다른 검사나 처리가 필요한 상황에 매우 유용


